<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', path='favicon-32x32.png') }}"
      referrerpolicy="no-referrer"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', path='favicon-16x16.png') }}"
      referrerpolicy="no-referrer"
    />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css"
        integrity="sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />
    <title>Shared config manager - {{ source.get_config().get("name", source.get_id()) }}</title>
    <style nonce="{{ nonce }}">
      body { padding-bottom: 1rem; }
      .header-actions { position: absolute; right: 1rem; }
      .text-right { text-align: right; }
      .logout-button { vertical-align: baseline; }
      .main-title { margin-bottom: 4rem; }
    </style>
  </head>
  <body>
    <script nonce="{{ nonce }}">
      (() => {
        'use strict'
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.setAttribute('data-bs-theme', 'dark');
        }
      })()
    </script>
    <div class="container-fluid">
      <div class="header-actions">
        <p class="text-right">
         {% if identity is not none %}
         Logged as: <a href="{{ identity.url }}">{{ identity.name }}</a>{% if identity.auth_type == "github_oauth" %},
         <a role="button" class="btn btn-secondary mt-4 logout-button"
         href="{{ url_for('c2c_github_logout') }}?came_from={{ request.url | urlencode }}">Logout</a>
         {% endif %}
         {% else %}
         <a class="btn btn-primary"
         href="{{ url_for('c2c_github_login') }}?came_from={{ request.url | urlencode }}">Login with GitHub</a>
         {% endif %}
        </p>

        <p class="text-right">
          <a class="btn btn-secondary" href="{{ url_for('ui_index') }}">Back to the list</a>
          <a class="btn btn-secondary" target="_blank" href="{{ url_for('_refresh_view', source_id=source.get_id()) }}">Refresh</a>
        </p>
      </div>

      <h1 class="main-title">{{ source.get_config().get("name", source.get_id()) }}</h1>

      <h3>Config</h3>
      <dl class="border rounded row mx-1">
        {% for c1, c2, c3, c4 in attributes %}
        <dt class="col-lg-2">{{ c1 }}</dt>
        <dd class="col-lg-4">{{ c2 }}</dd>
        <dt class="col-lg-2">{{ c3 }}</dt>
        <dd class="col-lg-4">{{ c4 }}</dd>
        {% endfor %}
      </dl>

      {% if slave_status %}
      <h3>Slaves statuses</h3>
      <ul class="list-group">
        {% for status, commit in slave_status %}
        <li class="list-group-item">
        <div class="row align-items-start">
          <div class="col">
            <h4>{{ status.get('hostname') }}</h4>
            <p>
            Tags: {{ ', '.join(status.get('tags', [])) if status.get('tags', []) else '-' }}<br>
            {% if commit %}
              {% for s in commit %}
              <br />
              {% if s is sequence and s is not string %}
              <a href="{{ s[0] }}">{{ s[1] }}</a>
              {% else %}
              {{ s }}
              {% endif %}
              {% endfor %}
            {% else %}
            {{ status.get('hash') }}
            {% endif %}
          </div>
          <div class="col">
            <h5>Template engines</h5>
            <ul class="list-group">
            {% for template_engine in status.get('template_engines', []) %}
            <li class="list-group-item">
            {% for key, value in template_engine.items() %}
            {% if value is sequence and value is not string and value is not mapping %}
            <b>{{ key_format(key) }}</b>: {{ ', '.join(value) }}<br />
            {% elif value is mapping %}
            <b>{{ key_format(key) }}</b>:<br />
            {% for k in value.keys()|sort %}
            &nbsp;&nbsp;&nbsp;&nbsp;{{ k }} = {{ value[k] }}<br />
            {% endfor %}
            {% else %}
            <b>{{ key_format(key) }}</b>: {{ value }}<br />
            {% endif %}
            {% endfor %}
            </li>
            {% endfor %}
            </ul>
          </div>
        </div>
        </li>
        {% endfor %}
      </ul>
      {% endif %}
    </div>
  </body>
</html>
